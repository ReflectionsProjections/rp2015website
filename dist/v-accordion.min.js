/**
 * vAccordion - AngularJS multi-level accordion component
 * @version v0.0.4
 * @link http://lukaszwatroba.github.io/v-accordion
 * @author Łukasz Wątroba <l@lukaszwatroba.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */

!function(e){"use strict";function n(n){return{restrict:"EA",replace:!0,transclude:!0,template:"<div ng-transclude></div>",scope:{control:"=?",allowMultiple:"=?"},controllerAs:"accordionCtrl",controller:o,compile:function(o){return o.addClass(n.classes.accordion),function(n,o,t){function i(){e.forEach(l,function(e){if(n.control[e])throw new Error(e+" method can not be overwritten")})}function a(){if(!e.isFunction(n.control.onExpand))throw new Error("onExpand callback must be a function");if(!e.isFunction(n.control.onCollapse))throw new Error("onCollapse callback must be a function")}e.isDefined(n.allowMultiple)||(n.allowMultiple=e.isDefined(t.allowMultiple));var l=["toggle","expand","collapse","expandAll","collapseAll"];n.$watch("control",function(){if(n.control&&n.control!==n.internalControl){i();var o=e.extend({},n.internalControl,n.control);n.control=n.internalControl=o,a()}else e.isDefined(n.control)||(n.control=n.internalControl)})}}}}function o(n){var o=this;n.isDisabled=!1,n.panes=[];var t=function(){for(var e=!1,o=0,t=n.panes.length;t>o;o++){var i=n.panes[o];if(i.isExpanded){e=!0;break}}return e},i=function(e){return n.panes[e]},a=function(e){return n.panes.indexOf(e)};o.disable=function(){n.isDisabled=!0},o.enable=function(){n.isDisabled=!1},o.addPane=function(e){if(!n.allowMultiple&&t()&&e.isExpanded)throw new Error("allow-multiple attribute is not set");n.panes.push(e),e.isExpanded&&n.internalControl.onExpand(a(e))},o.toggle=function(e){!n.isDisabled&&e&&(n.allowMultiple||o.collapseAll(e),e.isExpanded=!e.isExpanded,e.isExpanded?n.internalControl.onExpand(a(e)):n.internalControl.onCollapse(a(e)))},o.expand=function(e){!n.isDisabled&&e&&(n.allowMultiple||o.collapseAll(e),e.isExpanded||(e.isExpanded=!0,n.internalControl.onExpand(a(e))))},o.collapse=function(e){!n.isDisabled&&e&&e.isExpanded&&(e.isExpanded=!1,n.internalControl.onCollapse(a(e)))},o.expandAll=function(){if(!n.isDisabled){if(!n.allowMultiple)throw new Error("allow-multiple attribute is not set");e.forEach(n.panes,function(e){o.expand(e)})}},o.collapseAll=function(t){n.isDisabled||e.forEach(n.panes,function(e){e!==t&&o.collapse(e)})},n.internalControl={toggle:function(e){o.toggle(i(e))},expand:function(e){o.expand(i(e))},collapse:function(e){o.collapse(i(e))},expandAll:o.expandAll,collapseAll:o.collapseAll,onExpand:function(){},onCollapse:function(){}}}function t(e){return{restrict:"EA",require:"^vPane",transclude:!0,replace:!0,template:"<div><div ng-transclude></div></div>",scope:{},compile:function(n){return n.addClass(e.classes.paneContent),function(e,n,o,t){e.paneCtrl=t}}}}function i(e){return{restrict:"EA",require:"^vPane",transclude:!0,replace:!0,template:'<div ng-click="paneCtrl.toggle()"><div ng-transclude></div></div>',scope:{},compile:function(n){return n.addClass(e.classes.paneHeader),function(e,n,o,t){e.paneCtrl=t}}}}function a(n,o,t){return{restrict:"EA",require:"^vAccordion",transclude:!0,replace:!0,template:"<div ng-transclude></div>",scope:{isExpanded:"=?expanded"},controllerAs:"paneCtrl",controller:l,compile:function(i){return i.addClass(t.classes.pane),function(i,a,l,c){function r(){c.disable();var e=u.offsetHeight;p.style.maxHeight="0px",o.addClass(v,t.classes.expandedState).then(function(){c.enable(),p.style.maxHeight="none"}),setTimeout(function(){p.style.maxHeight=e+"px"},0),a.addClass(t.classes.expandedState),f.addClass(t.classes.expandedState)}function d(){c.disable();var e=u.offsetHeight;p.style.maxHeight=e+"px",o.removeClass(v,t.classes.expandedState).then(function(){c.enable()}),setTimeout(function(){p.style.maxHeight="0px"},0),a.removeClass(t.classes.expandedState),f.removeClass(t.classes.expandedState)}e.isDefined(i.isExpanded)||(i.isExpanded=e.isDefined(l.expanded));var s=a[0].querySelector("."+t.classes.paneHeader),p=a[0].querySelector("."+t.classes.paneContent);if(!s)throw new Error("v-pane-header not found");if(!p)throw new Error("v-pane-content not found");var u=p.querySelector("div"),f=e.element(s),v=e.element(p);c.addPane(i),i.accordionCtrl=c,p.style.maxHeight="0px",n(function(){i.isExpanded&&r()},100),i.$watch("isExpanded",function(e,n){return e===n?!0:(e?r():d(),void 0)})}}}}function l(e){var n=this;n.toggle=function(){e.isAnimating||e.accordionCtrl.toggle(e)}}e.module("vAccordion.config",[]).constant("accordionConfig",{classes:{accordion:"Accordion Accordion--dafault",pane:"Accordion-pane",paneHeader:"Accordion-paneHeader",paneContent:"Accordion-paneContent",expandedState:"is-expanded"}}),e.module("vAccordion.directives",["ngAnimate"]),e.module("vAccordion",["vAccordion.config","vAccordion.directives"]),e.module("vAccordion.directives").directive("vAccordion",n),n.$inject=["accordionConfig"],o.$inject=["$scope"],e.module("vAccordion.directives").directive("vPaneContent",t),t.$inject=["accordionConfig"],e.module("vAccordion.directives").directive("vPaneHeader",i),i.$inject=["accordionConfig"],e.module("vAccordion.directives").directive("vPane",a),a.$inject=["$timeout","$animate","accordionConfig"],l.$inject=["$scope"]}(angular);